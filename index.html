<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wake Up Challenge</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      padding: 1rem;
    }
    .card {
      background: white;
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 400px;
      width: 100%;
    }
    input[type="number"] {
      font-size: 1.25rem;
      padding: 0.5rem;
      margin-top: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border: none;
      background-color: #007AFF;
      color: white;
      border-radius: 0.75rem;
      cursor: pointer;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2 id="prompt">Loading...</h2>
    <input type="number" id="answer" inputmode="numeric" />
    <button onclick="submitAnswer()">Submit</button>
    <p id="feedback"></p>
  </div>

  <script>
    let questions = [];
    let currentIndex = 0;

    function getRandomInt(min, max, notDivisibleBy5 = false) {
      let num;
      do {
        num = Math.floor(Math.random() * (max - min + 1)) + min;
      } while (notDivisibleBy5 && num % 5 === 0);
      return num;
    }

    function generateQuestion() {
      const type = ["add", "sub", "mul"][Math.floor(Math.random() * 3)];

      if (type === "add" || type === "sub") {
        let a = getRandomInt(51, 999, true);
        let b = getRandomInt(51, 999, true);
        if (type === "sub" && b > a) [a, b] = [b, a]; // Ensure non-negative
        return {
          question: `${a} ${type === "add" ? "+" : "−"} ${b}`,
          answer: type === "add" ? a + b : a - b
        };
      } else {
        let a = getRandomInt(10, 50);
        let b;
        do {
          b = getRandomInt(2, 50);
        } while (b > 10 && b % 5 !== 0);
        return {
          question: `${a} × ${b}`,
          answer: a * b
        };
      }
    }

    function loadQuestions() {
      for (let i = 0; i < 3; i++) {
        questions.push(generateQuestion());
      }
      showQuestion();
    }

    function showQuestion() {
      if (currentIndex < questions.length) {
        document.getElementById("prompt").innerText = questions[currentIndex].question;
        document.getElementById("answer").value = "";
        document.getElementById("feedback").innerText = "";
      } else {
        document.getElementById("prompt").innerText = "✅ Task complete!";
        document.querySelector("input").classList.add("hidden");
        document.querySelector("button").classList.add("hidden");

        fetch("https://alarmclock-dopk.onrender.com/mark-complete", {
          method: "POST"
        });
      }
    }

    function submitAnswer() {
      const userAnswer = parseInt(document.getElementById("answer").value);
      const correct = questions[currentIndex].answer;
      if (userAnswer === correct) {
        currentIndex++;
        showQuestion();
      } else {
        document.getElementById("feedback").innerText = "❌ Incorrect, try again.";
      }
    }

    loadQuestions();
  </script>
</body>
</html>
